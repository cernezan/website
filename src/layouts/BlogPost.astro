---
import MainLayout from "./MainLayout.astro";
import PageImage from "../components/PageImage.astro";
import PageTitle from "../components/PageTitle.astro";
import CategoryDate from "../components/CategoryDate.astro";
import BackToBlog from "../components/BackToBlog.astro";

import { removeMarkdown } from "../utils";
import { CollectionEntry, getCollection } from "astro:content";

export interface Props {
    title: string;
    headerImage?: string;
    pubDate: Date;
    updatedDate?: Date;
    category: string;
}

const { title, headerImage, pubDate, updatedDate, category } = Astro.props;
const categoryPath = "/blog/category/";

let posts: CollectionEntry<"blog">[] = await getCollection("blog");
// postData is used for meta (social media) description
const postData = posts.filter((post) => post.slug === Astro.params.slug)[0];
---

<MainLayout
    title={title}
    image={headerImage}
    description={removeMarkdown(postData.body).slice(0, 400) + "..."}
    isPost={true}
>
    <!-- HEADER IMAGE -->
    <PageImage image={headerImage} title={title} category={category} />
    <!-- DATE AND CATEGORY -->
    <CategoryDate
        category={category}
        categoryPath={categoryPath}
        pubDate={pubDate}
        updatedDate={updatedDate}
    />
    <!-- TITLE -->
    <PageTitle>{title}</PageTitle>
    <!-- CONTENT -->
    <slot />

    <BackToBlog />
</MainLayout>
