---
import {getCollection} from "astro:content";
import {slugify} from "../../../utils";

import FormattedDate from "../../../components/FormattedDate.astro";
import MainLayout from "../../../layouts/MainLayout.astro";

export async function getStaticPaths() {
	let posts = await getCollection("blog");
	const uniqueCategory = [...new Set(posts.map((post: any) => post.data.category).flat())];

	return uniqueCategory.map((currentCategory) => {
		const filteredPosts = posts.filter((post: any) => post.data.category.includes(currentCategory));
		return {
			params: {category: slugify(currentCategory)},
			props: {posts: filteredPosts, categoryName: currentCategory},
		};
	});
}

const {posts, categoryName} = Astro.props;
---

<MainLayout>
	<main>
		<h1>{categoryName}</h1>
		<section>
			<ul>
				{
					posts.map((post: any) => (
						<li>
							<FormattedDate date={post.data.pubDate} />
							<a href={`/blog/${post.slug}/`}>{post.data.title}</a>
						</li>
					))
				}
			</ul>
		</section>
	</main>
</MainLayout>
